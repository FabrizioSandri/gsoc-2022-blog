<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Issue with RcppDeepState-action beta test | GSOC 2022 RcppDeepState</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Issue with RcppDeepState-action beta test" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Solution for the problem that prevents the action from being run in remote pull requests." />
<meta property="og:description" content="Solution for the problem that prevents the action from being run in remote pull requests." />
<link rel="canonical" href="https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/30/rcppdeepstate-beta-test-2.html" />
<meta property="og:url" content="https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/30/rcppdeepstate-beta-test-2.html" />
<meta property="og:site_name" content="GSOC 2022 RcppDeepState" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-08-30T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Issue with RcppDeepState-action beta test" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-30T00:00:00-05:00","datePublished":"2022-08-30T00:00:00-05:00","description":"Solution for the problem that prevents the action from being run in remote pull requests.","headline":"Issue with RcppDeepState-action beta test","mainEntityOfPage":{"@type":"WebPage","@id":"https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/30/rcppdeepstate-beta-test-2.html"},"url":"https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/30/rcppdeepstate-beta-test-2.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/gsoc-2022-blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://fabriziosandri.github.io/gsoc-2022-blog/feed.xml" title="GSOC 2022 | RcppDeepState" /><link rel="shortcut icon" type="image/x-icon" href="/gsoc-2022-blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/gsoc-2022-blog/">GSOC 2022 | RcppDeepState</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/gsoc-2022-blog/search/">Search</a><a class="page-link" href="/gsoc-2022-blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Issue with RcppDeepState-action beta test</h1><p class="page-description">Solution for the problem that prevents the action from being run in remote pull requests.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-08-30T00:00:00-05:00" itemprop="datePublished">
        Aug 30, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      6 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/gsoc-2022-blog/categories/#GitHub Action">GitHub Action</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="introduction-to-the-issue">Introduction to the issue</h2>
<p>After performing beta tests on the binsegRcpp<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup> package using 
RcppDeepState-action I discovered two issues.</p>

<p>The first is that the user need consent from a single maintainer with write 
access before running a workflow within a remote repository. This has been
demonstrated with my mentor through pull request 
<a href="https://github.com/tdhock/binsegRcpp/pull/16">tdhock/binsegRcpp#16</a>.
In fact, this is explicitly stated in the GitHub documentation<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup>:</p>

<blockquote>
  <p>To help prevent this, workflows on pull requests to public repositories from 
some outside contributors will not run automatically, and might need to be 
approved first. By default, all first-time contributors require approval to run 
workflows.</p>
</blockquote>

<p>However, this is not the only issue: the person who opens a pull request is not
permitted to use the remote repository’s <code class="language-plaintext highlighter-rouge">GITHUB_TOKEN</code> to automatically add a 
comment in the pull request. The token is only valid inside the same repository. 
This is clearly explained in the GitHub docs<sup id="fnref:3" role="doc-noteref"><a href="#fn:3" class="footnote" rel="footnote">3</a></sup>:</p>

<blockquote>
  <p>When you enable GitHub Actions, GitHub installs a GitHub App on your 
repository. The GITHUB_TOKEN secret is a GitHub App installation access token. 
You can use the installation access token to authenticate on behalf of the 
GitHub App installed on your repository. The token’s permissions are limited to
the repository that contains your workflow.</p>
</blockquote>

<h2 id="workaround">Workaround</h2>
<p>The primary purpose is to run RcppDeepState-action on CRAN packages available on
GitHub and share the findings with the package authors. To accomplish this task,
the following steps can be used as a workaround for the previous issues:</p>

<ol>
  <li>fork the remote repository;</li>
  <li>Create a self-pull request(from fork to fork) in the forked repository to 
examine the package using RcppDeepState-action;</li>
  <li>If RcppDeepState finds at least one error, make a pull request on the remote 
repository(from fork to upstream);</li>
  <li>Copy and paste the RcppDeepState report from the forked repository’s pull 
request into the pull request of the remote repository.</li>
</ol>

<h2 id="implementation">Implementation</h2>
<p>According to the script that automatically forks and opens a self pull request
written in the previous blog post<sup id="fnref:4" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>, we can write a script that, after the 
RcppDeepState-action workflow is done, opens a remote pull request on the
original repository and copies and pastes the RcppDeepState report within the
remote pull request.</p>

<p>The first step is to import the required libraries and get the GitHub personal 
access token (PAT) stored in an environment variable called GITHUB_PAT in my 
case. This token will be used to authorize the push of local commits to a 
repository’s remote branch. To generate this token, you can follow the 
instructions provided by GitHub<sup id="fnref:5" role="doc-noteref"><a href="#fn:5" class="footnote" rel="footnote">5</a></sup>.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="s2">"gh"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"git2r"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"data.table"</span><span class="p">)</span><span class="w">

</span><span class="n">cred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cred_token</span><span class="p">(</span><span class="n">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GITHUB_PAT"</span><span class="p">)</span><span class="w">
</span><span class="n">batch_size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="c1"># adjust the batch size</span><span class="w">
</span><span class="n">organization</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"RcppDeepState"</span><span class="w">
</span></code></pre></div></div>

<p>In this case, we have defined two additional parameters, one of which is the 
<code class="language-plaintext highlighter-rouge">batch_size</code> parameter, which limits the number of packages tested. This option
must be equivalent to the <code class="language-plaintext highlighter-rouge">batch_size</code> parameter used when executing the script
that forks and creates a pull request<sup id="fnref:4:1" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>, or else some pull request will not be
submitted. Furthermore, we define the <code class="language-plaintext highlighter-rouge">organization</code> parameter, which searches 
for forked repositories inside the organization provided in this parameter. This
parameter has been added after the problem outlined in the <a href="https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/23/rcppdeepstate-beta-test.html#future-work">Future work</a> 
paragraph of the previous blog post.</p>

<p>Given a <code class="language-plaintext highlighter-rouge">pkg.repos</code> data table produced by following the steps specified in 
Dr.Toby Dylan Hocking’s blog post<sup id="fnref:6" role="doc-noteref"><a href="#fn:6" class="footnote" rel="footnote">6</a></sup>, the implementation of the automatic
process outlined above is described in the next steps.</p>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">pkg.repos</span><span class="w">
          </span><span class="n">Package</span><span class="w">                                  </span><span class="n">repo.url</span><span class="w">
  </span><span class="m">1</span><span class="o">:</span><span class="w"> </span><span class="n">humaniformat</span><span class="w"> </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">ironholds</span><span class="o">/</span><span class="n">humaniformat</span><span class="w">
  </span><span class="m">2</span><span class="o">:</span><span class="w">       </span><span class="n">jmotif</span><span class="w">        </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">jMotif</span><span class="o">/</span><span class="n">jmotif</span><span class="o">-</span><span class="n">R</span><span class="w">
  </span><span class="m">3</span><span class="o">:</span><span class="w">     </span><span class="n">olctools</span><span class="w">     </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">Ironholds</span><span class="o">/</span><span class="n">olctools</span><span class="w">
  </span><span class="m">4</span><span class="o">:</span><span class="w">  </span><span class="n">RcppDynProg</span><span class="w">  </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">WinVector</span><span class="o">/</span><span class="n">RcppDynProg</span><span class="w">
  </span><span class="m">5</span><span class="o">:</span><span class="w">      </span><span class="n">BWStest</span><span class="w">     </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">shabbychef</span><span class="o">/</span><span class="n">BWStest</span><span class="w">
 </span><span class="o">---</span><span class="w">                                                       
</span><span class="m">111</span><span class="o">:</span><span class="w">       </span><span class="n">tweenr</span><span class="w">       </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">thomasp85</span><span class="o">/</span><span class="n">tweenr</span><span class="w">
</span><span class="m">112</span><span class="o">:</span><span class="w">         </span><span class="n">uwot</span><span class="w">        </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">jlmelville</span><span class="o">/</span><span class="n">uwot</span><span class="w">
</span><span class="m">113</span><span class="o">:</span><span class="w">       </span><span class="n">vapour</span><span class="w">       </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">hypertidy</span><span class="o">/</span><span class="n">vapour</span><span class="w">
</span><span class="m">114</span><span class="o">:</span><span class="w">           </span><span class="n">wk</span><span class="w">         </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">paleolimbot</span><span class="o">/</span><span class="n">wk</span><span class="w">
</span><span class="m">115</span><span class="o">:</span><span class="w">      </span><span class="n">wkutils</span><span class="w">    </span><span class="n">https</span><span class="o">://</span><span class="n">github.com</span><span class="o">/</span><span class="n">paleolimbot</span><span class="o">/</span><span class="n">wkutils</span><span class="w">
</span></code></pre></div></div>

<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pkg.repos</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nc</span><span class="o">::</span><span class="n">capture_first_df</span><span class="p">(</span><span class="n">pkg.repos</span><span class="p">,</span><span class="w"> </span><span class="n">repo.url</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="w">
                                  </span><span class="s2">"https://github.com/"</span><span class="p">,</span><span class="w"> </span><span class="n">repo_full_name</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="w">
                                  </span><span class="s2">".*/"</span><span class="p">,</span><span class="w"> </span><span class="n">repo_name</span><span class="o">=</span><span class="s2">".*"</span><span class="p">)))</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">repo_i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">pkg.repos</span><span class="p">)))){</span><span class="w">
  </span><span class="n">repo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pkg.repos</span><span class="p">[</span><span class="n">repo_i</span><span class="p">]</span><span class="w">
  </span><span class="n">fork_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">organization</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_name</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"/"</span><span class="p">)</span><span class="w">
  </span><span class="n">fork_pull_url</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"https://github.com"</span><span class="p">,</span><span class="w"> </span><span class="n">fork_name</span><span class="p">,</span><span class="w"> </span><span class="s2">"pull"</span><span class="p">,</span><span class="w"> </span><span class="s2">"1"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"/"</span><span class="p">)</span><span class="w">

  </span><span class="c1"># get the report comment from the forked repository</span><span class="w">
  </span><span class="n">fork_comments_endpoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"GET /repos/"</span><span class="p">,</span><span class="w"> </span><span class="n">fork_name</span><span class="p">,</span><span class="w"> 
                                   </span><span class="s2">"/issues/1/comments"</span><span class="p">)</span><span class="w">
  </span><span class="n">rcppdeepstate_pull</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gh</span><span class="p">(</span><span class="n">fork_comments_endpoint</span><span class="p">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">rcppdeepstate_pull</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">){</span><span class="w">
    </span><span class="n">warn_msg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"The report comment has not been generated for"</span><span class="p">,</span><span class="w"> 
                      </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">)</span><span class="w">
    </span><span class="n">message</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
    </span><span class="n">rcppdeepstate_comment</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sub</span><span class="p">(</span><span class="s2">"&lt;!-- RcppDeepState-action comment--&gt;"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
                                </span><span class="n">rcppdeepstate_pull</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">body</span><span class="p">)</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"No error has been reported"</span><span class="p">,</span><span class="w"> </span><span class="n">rcppdeepstate_comment</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)){</span><span class="w">
      </span><span class="n">warn_msg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"No error has been reported by RcppDeepState for the"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"package"</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">)</span><span class="w">
      </span><span class="n">message</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="w">
      </span><span class="c1"># get the remote repo default branch name</span><span class="w">
      </span><span class="n">upstream_endpoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"GET /repos/"</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">)</span><span class="w">
      </span><span class="n">upstream_details</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gh</span><span class="p">(</span><span class="n">upstream_endpoint</span><span class="p">)</span><span class="w">

      </span><span class="c1"># open a pull request in the original repository</span><span class="w">
      </span><span class="n">pulls_endpoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"POST /repos/"</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">,</span><span class="w"> </span><span class="s2">"/pulls"</span><span class="p">)</span><span class="w">
      </span><span class="n">pull_title</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Analyze the package with RcppDeepState"</span><span class="w">
      </span><span class="n">pull_body</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"### RcppDeepState Analysis\nThis package contains"</span><span class="p">,</span><span class="w"> 
                        </span><span class="s2">"problems, according to RcppDeepState. The report was"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"generated by [RcppDeepState-action](https://github.com/FabrizioSandri/RcppDeepState-action)"</span><span class="p">,</span><span class="w">
                        </span><span class="s2">"in this repository's fork and is accessible [here]("</span><span class="p">,</span><span class="w">
                        </span><span class="n">fork_pull_url</span><span class="p">,</span><span class="w"> </span><span class="s2">")."</span><span class="p">)</span><span class="w">

      </span><span class="n">head</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">organization</span><span class="p">,</span><span class="w"> </span><span class="s2">"RcppDeepState"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">":"</span><span class="p">)</span><span class="w">
      </span><span class="n">pull_response</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gh</span><span class="p">(</span><span class="n">pulls_endpoint</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="o">=</span><span class="n">pull_title</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="n">pull_body</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">owner</span><span class="o">=</span><span class="n">upstream_details</span><span class="o">$</span><span class="n">owner</span><span class="o">$</span><span class="n">login</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">=</span><span class="n">repo</span><span class="o">$</span><span class="n">repo_name</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">base</span><span class="o">=</span><span class="n">upstream_details</span><span class="o">$</span><span class="n">default_branch</span><span class="p">,</span><span class="w"> </span><span class="n">head</span><span class="o">=</span><span class="n">head</span><span class="p">)</span><span class="w">

      </span><span class="c1"># issue a comment with the rcppdeepstate report</span><span class="w">
      </span><span class="n">pull_number</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pull</span><span class="w"> </span><span class="n">request_response</span><span class="o">$</span><span class="n">number</span><span class="w">
      </span><span class="n">original_comments_endpoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"POST /repos/"</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">,</span><span class="w"> 
                                      </span><span class="s2">"/issues/"</span><span class="p">,</span><span class="w"> </span><span class="n">pull_number</span><span class="p">,</span><span class="w"> </span><span class="s2">"/comments"</span><span class="p">)</span><span class="w">
      </span><span class="n">gh</span><span class="p">(</span><span class="n">original_comments_endpoint</span><span class="p">,</span><span class="w"> </span><span class="n">owner</span><span class="o">=</span><span class="n">upstream_details</span><span class="o">$</span><span class="n">owner</span><span class="o">$</span><span class="n">login</span><span class="p">,</span><span class="w"> 
        </span><span class="n">repo</span><span class="o">=</span><span class="n">repo</span><span class="o">$</span><span class="n">repo_name</span><span class="p">,</span><span class="w"> </span><span class="n">issue_number</span><span class="o">=</span><span class="n">pull_number</span><span class="p">,</span><span class="w"> </span><span class="n">body</span><span class="o">=</span><span class="n">rcppdeepstate_comment</span><span class="p">)</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="test">Test</h2>
<p>Before we execute the aforementioned script, we must first run the previous blog
post’s code<sup id="fnref:4:2" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup> to fork the original repository and create the RcppDeepState 
reports. Remember that the new repositories will be created within the 
organization specified in the relative variable, as described in the
<a href="https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/23/rcppdeepstate-beta-test.html#future-work">Future work</a>
paragraph of the previous blog post<sup id="fnref:4:3" role="doc-noteref"><a href="#fn:4" class="footnote" rel="footnote">4</a></sup>.</p>

<p>Following that, we can ensure that all reports for the repositories being
tested have been generated automatically using the following piece of code:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">repo_i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">pkg.repos</span><span class="p">)))){</span><span class="w">
  </span><span class="n">repo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">pkg.repos</span><span class="p">[</span><span class="n">repo_i</span><span class="p">]</span><span class="w">
  </span><span class="n">fork_name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">organization</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_name</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"/"</span><span class="p">)</span><span class="w">

  </span><span class="n">fork_comments_endpoint</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"GET /repos/"</span><span class="p">,</span><span class="w"> </span><span class="n">fork_name</span><span class="p">,</span><span class="w"> 
                                   </span><span class="s2">"/issues/1/comments"</span><span class="p">)</span><span class="w">
  </span><span class="n">rcppdeepstate_pull</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gh</span><span class="p">(</span><span class="n">fork_comments_endpoint</span><span class="p">)</span><span class="w">
  
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">rcppdeepstate_pull</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">1</span><span class="p">){</span><span class="w">
    </span><span class="n">warn_msg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"The report for"</span><span class="p">,</span><span class="w"> </span><span class="n">repo</span><span class="o">$</span><span class="n">repo_full_name</span><span class="p">,</span><span class="w">
                      </span><span class="s2">"has not yet been generated."</span><span class="p">)</span><span class="w">
    </span><span class="n">message</span><span class="p">(</span><span class="n">warn_msg</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>I tested this script an hour after the automatic fork procedure had finished 
with a batch size of <code class="language-plaintext highlighter-rouge">10</code>, and it reported that the report for two repositories 
had not been generated.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The report comment has not been generated for ekstroem/MESS
The report comment has not been generated for MikeJaredS/hermiter
</code></pre></div></div>

<p>By analyzing the logs, I discovered that the were not generated because of a 
missing library that is not installed and is not specified in the package’s 
prerequisites. According to the error message for the <code class="language-plaintext highlighter-rouge">hermiter</code> package, the
missing library is <code class="language-plaintext highlighter-rouge">RcppParallel</code>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fatal error: <span class="s1">'RcppParallel.h'</span> file not found
<span class="c">#include &lt;RcppParallel.h&gt;</span>
         ^~~~~~~~~~~~~~~~
</code></pre></div></div>

<h3 id="run-the-remote-pull-request-script">Run the remote pull request script</h3>
<p>Running the script that submits a pull request remotely will result in the 
following output:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span><span class="w"> </span><span class="n">source</span><span class="p">(</span><span class="s2">"remote_pull.R"</span><span class="p">)</span><span class="w">
</span><span class="n">No</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">reported</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">RcppDeepState</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="n">shabbychef</span><span class="o">/</span><span class="n">BWStest</span><span class="w">
</span><span class="n">The</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ekstroem</span><span class="o">/</span><span class="n">MESS</span><span class="w">
</span><span class="n">The</span><span class="w"> </span><span class="n">report</span><span class="w"> </span><span class="n">comment</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">not</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">generated</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MikeJaredS</span><span class="o">/</span><span class="n">hermiter</span><span class="w">
</span></code></pre></div></div>
<p>Aside from the two previously mentioned repositories, the remote pull request 
for shabbychef/BWStest will not be submitted because RcppDeepState found no 
errors. Instead, the report will be submitted in a matter of seconds to the
following repositories:</p>
<ul>
  <li>ironholds/humaniformat <a href="https://github.com/Ironholds/humaniformat/pull/8">pull request #8</a></li>
  <li>jMotif/jmotif-R <a href="https://github.com/jMotif/jmotif-R/pull/35">pull request #35</a></li>
  <li>Ironholds/olctools <a href="https://github.com/Ironholds/olctools/pull/6">pull request #6</a></li>
  <li>WinVector/RcppDynProg <a href="https://github.com/WinVector/RcppDynProg/pull/1">pull request #1</a></li>
  <li>CollinErickson/CGGP <a href="https://github.com/CollinErickson/CGGP/pull/44">pull request #44</a></li>
  <li>paulhibbing/PAutilities <a href="https://github.com/paulhibbing/PAutilities/pull/8">pull request #8</a></li>
  <li>ms609/Quartet <a href="https://github.com/ms609/Quartet/pull/63">pull request #63</a></li>
</ul>

<h2 id="conclusion-and-future-work">Conclusion and Future work</h2>
<p>With this article demonstrated how to add another step to the script that 
automatically forks and opens a pull request to the remote repositories. In this
manner, I used a workaround to address the issues described in the article’s 
introduction.</p>

<p>Future work will involve increasing the <code class="language-plaintext highlighter-rouge">batch_size</code> option to the
maximum supported value in order to detect issues in all of the packages 
identified by Akhila.</p>

<hr />

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p><a href="https://github.com/tdhock/binsegRcpp">binsegRcpp repository</a> <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">
      <p><a href="https://docs.github.com/en/actions/managing-workflow-runs/approving-workflow-runs-from-public-forks">Approving workflow runs from public forks</a> <a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:3" role="doc-endnote">
      <p><a href="https://docs.github.com/en/actions/security-guides/automatic-token-authentication">Automatic token authentication</a> <a href="#fnref:3" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:4" role="doc-endnote">
      <p><a href="https://fabriziosandri.github.io/gsoc-2022-blog/github%20action/2022/08/23/rcppdeepstate-beta-test.html">Beta test RcppDeepState-action on GitHub hosted CRAN packages</a> <a href="#fnref:4" class="reversefootnote" role="doc-backlink">&#8617;</a> <a href="#fnref:4:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a> <a href="#fnref:4:2" class="reversefootnote" role="doc-backlink">&#8617;<sup>3</sup></a> <a href="#fnref:4:3" class="reversefootnote" role="doc-backlink">&#8617;<sup>4</sup></a></p>
    </li>
    <li id="fn:5" role="doc-endnote">
      <p><a href="https://docs.github.com/en/enterprise-server@3.4/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">Creating a personal access token</a> <a href="#fnref:5" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:6" role="doc-endnote">
      <p><a href="https://tdhock.github.io/blog/2022/packages-on-github/">R packages on github</a> <a href="#fnref:6" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div><a class="u-url" href="/gsoc-2022-blog/github%20action/2022/08/30/rcppdeepstate-beta-test-2.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/gsoc-2022-blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/gsoc-2022-blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/gsoc-2022-blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Blog for the GSOC 2022 edition | RcppDeepState</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/FabrizioSandri" target="_blank" title="FabrizioSandri"><svg class="svg-icon grey"><use xlink:href="/gsoc-2022-blog/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
